<!DOCTYPE html>
<html>
  <head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
    <title>搜索菜单</title>
    <style>
      * {
        box-sizing: border-box;
      }

      .red {
        color: red;
        /*font-size: 24px;*/
      }
    </style>
  </head>
  <body>
    <div>
      <input id="ipt" type="text" value="人生">
      <button onclick="onClickSearch()">搜索</button>
    </div>
    <div id="app"></div>
  </body>
</html>
<script src="../assets/lib/jquery/jquery-1.7.2.min.js"></script>
<script>
  let menuArr = [
    {
      name: '人生不相见，动如参与商⑵。Life does not meet, such as moving to participate in business.',
    },
    {
      name: '今夕复何夕，共此灯烛光。Today evening after what evening, a total of this lamp candlelight.',
    },
    {
      name: '少壮能几时，鬓发各已苍⑶。How long can a young man, hair on the temples have been dark ⑶.',
    },
    {
      name: '焉知二十载，重上君子堂。Visit old half ghost, exclaim hot bowel ⑸.',
    },
    {
      name: '昔别君未婚，儿女忽成行⑹。How to know twenty years, heavy gentleman\'s hall.',
    },
    {
      name: '怡然敬父执⑺，问我来何方。Don\'t unmarried jun, children suddenly become the.',
    },
  ]

  let html = ''
  dfs(menuArr, function (item) {
    html += ("<p>" + item.name + "</p>")
  })
  $('#app').html(html)

  function onClickSearch () {
    let val = $('#ipt').val();
    if (!val) return;

    let html = ''

    let fun = function (item) {
      let res = search(item.name, val)
      console.log(res)
      res && (html += ("<p>" + res + "</p>"))
    }

    dfs(menuArr, fun)

    $('#app').html(html)
  }

  function dfs (obj, fun) {
    if (Array.isArray(obj)) {
      obj && obj.forEach(ele => dfs(ele, fun))
    } else {
      fun(obj)
      obj.children && obj.children.forEach(ele => dfs(ele, fun))
    }
  }

  function search (template, searchStr) {
    let pattern = new RegExp(searchStr, "gi");
    let match = []
    let pointer = 0

    let html = ''

    while ((match = pattern.exec(template)) !== null) {
      // console.log("match:", match)
      // console.log("下一次匹配开始的位置:", pointer)
      // console.log("匹配到的开始位置:", match.index)
      // console.log("匹配开始 - 匹配到之间的字符串:", template.slice(pointer, match.index))
      // console.log("匹配到的字符串:", match[0])

      html += template.slice(pointer, match.index)
      html += "<span class='red'>" + match[0] + "</span>"

      pointer = match.index + match[0].length;
      // console.log(pointer)
      // console.log('\n')
    }

    if (!pointer) return false

    html += template.slice(pointer)

    return html;
  }
</script>
