var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),r=i.prototype;return r.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},r.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),r=i.prototype;return r.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},r.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},r.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},r.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},r.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},r.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},r.createGameScene=function(){var e=this.createBitmapByName("bg_jpg");this.addChild(e);var t=this.stage.stageWidth,i=this.stage.stageHeight;e.width=t,e.height=i;var r=new zmovie.ZMovieClip("s1_json",RES.getRes("mc3_json"));r.x=0,r.y=0,this.addChild(r);var a=new egret.Shape;a.graphics.beginFill(16711680,.3),a.graphics.drawRect(0,0,this.stage.stageWidth,200),a.graphics.endFill(),this.addChild(a),console.log("drag width:"+a.width),a.y=300,a.touchEnabled=!0;var n=null,l="",s=void 0,h=void 0;a.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){n=!0,s=e.localX,h=r.getCurrFrame(),r.stop()},this),a.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){e.localX>s?(h=h++>r.getTotalFrame()?0:h,l="right"):(h=h--<0?r.getTotalFrame():h,l="left"),r.gotoAndStop(h),s=e.localX},this),a.addEventListener(egret.TouchEvent.TOUCH_END,function(e){n=!1},this),this.addEventListener(egret.Event.ENTER_FRAME,function(e){null!=n&&0==n&&("right"==l?r.nextFrame():r.prevFrame())},this)},r.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},r.startAnimation=function(e){for(var t=this,i=new egret.HtmlTextParser,r=[],a=0;a<e.length;a++)r.push(i.parser(e[a]));var n=t.textfield,l=-1,s=function(){l++,l>=r.length&&(l=0);var e=r[l];t.changeDescription(n,e);var i=egret.Tween.get(n);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(s,t)};s()},r.changeDescription=function(e,t){e.textFlow=t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var zmovie;!function(e){var t=function(t){function i(e,i,r){t.call(this),this.setObject(e,i,r)}__extends(i,t);var r=(__define,i),a=r.prototype;return a.setObject=function(t,i,r){if(this.libObj!=i||this.libName!=r){this.libName=r,this.libObj=i,e.Util.clearDisposeDisplay(this);for(var a=e.Util.getTextureArrByName(t,i,r),n=a.length,l=n-1;l>=0;l--){var s=a[l],h=new egret.Bitmap;h.touchEnabled=!1,h.texture=s.t,h.x=s.x/i.scale,h.y=s.y/i.scale,this.addChild(h)}}},i}(egret.DisplayObjectContainer);e.LargeImage=t,egret.registerClass(t,"zmovie.LargeImage")}(zmovie||(zmovie={}));var zmovie;!function(e){var t=function(){function e(){}var t=(__define,e);t.prototype;return e.clearDisposeDisplay=function(e){try{for(var t,i=e.numChildren-1;i>=0;i--)t=e.getChildAt(i),e.removeChild(t)}catch(r){}},e.getTextureArrByName=function(t,i,r){var a=[],n=e.getTextureByName(t,r);if(null==n){var l=i.clipping[r];if(null!=l)for(var s=l.length-1;s>=0;s--){if(n=e.getTextureByName(t,l[s].name),null==n)return a;a.push({t:n,x:l[s].x,y:l[s].y})}return a}return a.push({t:n,x:0,y:0}),a},e.getTextureByName=function(e,t){var i=null;try{i=RES.getRes(e+"."+t)}catch(r){}try{if(null==i)for(var a=e,n=a.length-1;n>=0;n--){var i=RES.getRes(a[n]+"."+t);if(null!=i)return i}}catch(r){}return i},e}();e.Util=t,egret.registerClass(t,"zmovie.Util")}(zmovie||(zmovie={}));var zmovie;!function(e){var t=function(){function e(){}var t=(__define,e);t.prototype;return e}();e.ZAssetManager=t,egret.registerClass(t,"zmovie.ZAssetManager")}(zmovie||(zmovie={}));var zmovie;!function(e){var t=function(e){function t(t){e.call(this),this.img=new egret.Bitmap,this.addChild(this.img),this.setTexture(t)}__extends(t,e);var i=(__define,t),r=i.prototype;return r.setTexture=function(e){this.img.texture=e},r.setScale=function(e){this.img.scaleX=1/e,this.img.scaleY=1/e},t}(egret.DisplayObjectContainer);e.ZImage=t,egret.registerClass(t,"zmovie.ZImage")}(zmovie||(zmovie={}));var zmovie;!function(e){var t=function(t){function i(e,i,r,a){void 0===r&&(r=null),void 0===a&&(a=1),t.call(this),this.isPlay=!1,this.setMovieObject(e,i,r,a)}__extends(i,t);var r=(__define,i),a=r.prototype;return a.getTotalFrame=function(){return this.totalFrame},a.getCurrPlayLabel=function(){return this.currPlaylabel},a.getCurrFrame=function(){return this.currFrame},a.getIsPlay=function(){return this.isPlay},a.setTimeScale=function(e){0>=e&&(e=.01),this._timeScale=e,null!=this.mcObj&&(this.frameTime=this.mcObj.frameTime/e);for(var t=this.numChildren-1;t>=0;t--){var r=null;this.getChildAt(t)instanceof i&&(r=this.getChildAt(t)),null!=r&&r.setTimeScale(e)}},a.getTimeScale=function(){return this._timeScale},a.getLabels=function(){return this.mcObj.frameLabels},a.getIsExistLabel=function(e){return null!=this.mcObj.frameLabels&&null!=this.mcObj.frameLabels[e]?!0:!1},a.getCurrLabelObj=function(){var e=this.getLabels();if(null!=e)for(var t in e)if(this.currFrame>=e[t].begin){if(null!=e[t].end&&this.currFrame>=e[t].end)continue;return e[t]}return null},i.getFrameMovieObject=function(e,t){return null==e.f_arr&&(e.f_arr=[]),e.f_arr.unshift(e),e},a.gotoAndPlayLabel=function(e,t){void 0===t&&(t=!1);var r;return null!=this.mcObj.frameLabels&&(r=this.mcObj.frameLabels[e],null!=r?(this.currPlaylabel=e,this.beginFrame=r.begin,null==r.end||t?this.endFrame=-1:this.endFrame=r.end-1,this.gotoAndPlay(this.beginFrame)):(this.beginFrame=0,this.endFrame=-1,this.currPlaylabel=null,this.gotoAndPlay(this.beginFrame)),this.dispatchEventWith(i.EVENT_GOTOANDPLAYLABEL,!1,e)),r},a.disposeLayerImg=function(){if(null!=this.layerArr)for(var e=this.layerArr.length-1;e>=0;e--){var t=this.layerArr[e].img;null!=t&&null!=t.parent&&t.parent.removeChild(t);var i=this.layerArr[e].mc;null!=i&&null!=i.parent&&i.parent.removeChild(i);var r=this.layerArr[e].li;null!=r&&null!=r.parent&&r.parent.removeChild(r)}},a.setMovieObject=function(e,t,r,a){void 0===a&&(a=1),null==r&&(r="root"),this.imgArr=e,this.libObj=t,this._mcName=r,this.mcObj=t.mcObjs[r],this.areaObj=this.mcObj.areaObject,this.libScale=1,this._direction=1,this.fmObj=this.mcObj.frameMoveObj,this.currFrame=-1,this.totalFrame=this.mcObj.totalFrame,this.frameTime=this.mcObj.frameTime,this.beginFrame=0,this.endFrame=-1,this._timeScale=1,this.isLoop=!0,this.disposeLayerImg(),this.parentCFOObj={},this.layerArr=new Array,this.currArea=null;for(var n=this.mcObj.layers,l=n.length,s=0;l>s;s++){for(var h,o=new Array,m=n[s],c=m.length,u=null,d=0;c>d;d++){var g=m[d],v=null;if(null==g.matrix){var f=g.frameNum;for(null==g.libName&&null!=u&&null!=g.x&&(g.libName=u.libName),null==g.a&&(g.a=1),null==g.b&&(g.b=0),null==g.c&&(g.c=0),null==g.d&&(g.d=1),null==g.al&&(g.al=1),null==g.cx?g.cx=0:g.cx*=-1,null==g.cy?g.cy=0:g.cy*=-1,null==g.r&&(g.r=0),null==g.sx&&(g.sx=1),null==g.sy&&(g.sy=1),(null!=g.scaleX||null!=g.scaleY||null!=g.scaleZ||null!=g.rotationX||null!=g.rotationY||null!=g.rotationZ)&&(v={},v.scaleX=g.scaleX,v.scaleY=g.scaleY,v.scaleZ=g.scaleZ,v.x=g.x,v.y=g.y,v.cx=g.cx,v.cy=g.cy,g.cx=0,g.cy=0,g.x=0,g.y=0,v.rotationX=g.rotationX,v.rotationY=g.rotationY,v.rotationZ=g.rotationZ,null==v.scaleX&&(v.scaleX=1),null==v.scaleY&&(v.scaleY=1),null==v.scaleZ&&(v.scaleZ=1),null==v.rotationX&&(v.rotationX=0),null==v.rotationY&&(v.rotationY=0),null==v.rotationZ&&(v.rotationZ=0)),g.matrix=new egret.Matrix(g.a,g.b,g.c,g.d,g.x,g.y),h=0;f>h;h++)i.getFrameMovieObject(g,h+1);for(var p in g)"id"!=p&&"maskID"!=p&&"op"!=p&&"mcName"!=p&&"matrix"!=p&&"al"!=p&&"libName"!=p&&"f_arr"!=p&&"cx"!=p&&"cy"!=p&&"r"!=p&&"sx"!=p&&"sy"!=p&&delete g[p];null!=v&&(g.obj3d=v)}o.push(g);var E=g.f_arr;if(null!=E)for(h=E.length-1;h>=0;h--)o.push(E[h]);u=g}this.layerArr.push({frames:o})}this.parentPlayTime=0,this.scale=a,this.advanceTime()},a.nextFrame=function(){this.stop(),this.parentPlayTime=0,this.isPlay=!0,this.advanceTime(),this.isPlay=!1},a.prevFrame=function(){this.stop(),this.currFrame-=2,-1>this.currFrame&&(this.currFrame=this.totalFrame-2),-1>this.currFrame&&(this.currFrame=-1),this.parentPlayTime=0,this.isPlay=!0,this.advanceTime(),this.isPlay=!1},a.stop=function(){if(this.isPlay){this.isPlay=!1,this.removeEventListener(egret.Event.ENTER_FRAME,this.advanceTime,this);for(var e=this.numChildren-1;e>=0;e--)if(this.getChildAt(e)instanceof i){var t=this.getChildAt(e);t.stop()}}},a.play=function(){if(!this.isPlay){this.isPlay=!0,this.addEventListener(egret.Event.ENTER_FRAME,this.advanceTime,this);for(var e=this.numChildren-1;e>=0;e--)if(this.getChildAt(e)instanceof i){var t=this.getChildAt(e);this.mcObj.frameTime!=t.mcObj.frameTime&&t.play()}}},a.frameComplete=function(){this.dispatchEventWith(i.EVENT_FRAME_COMPLETE,!1)},a.framePlay=function(){null!=this.areaObj&&(this.currArea=this.areaObj[this.currFrame],null!=this.currArea&&this.dispatchEventWith(i.EVENT_AREA,!1,this.currArea)),this.dispatchEventWith(i.EVENT_ENTER_FRAME)},a.addChildToDepth=function(e){var t=this.numChildren-1;if(0==t)return void this.addChild(e);for(var i=t;i>=0;i--)try{var r=this.getChildAt(i);if(null!=r&&r.img_depth<e.img_depth)return void(t==i?this.addChild(e):this.addChildAt(e,i+1))}catch(a){}this.addChildAt(e,0)},a.gotoAndStop=function(e){this.stop(),this.currFrame=e-1,this.parentPlayTime=0,this.isPlay=!0,this.advanceTime(),this.isPlay=!1},a.gotoAndPlay=function(e){this.currFrame=e-1,this.parentPlayTime=0,this.advanceTime(),this.play()},a.advanceTime=function(){var t=(new Date).getTime();if(this.frameTime<t-this.parentPlayTime){if(this.parentPlayTime=t,this.currFrame++,this.currFrame>=this.totalFrame||-1!=this.endFrame&&this.currFrame>this.endFrame){if(!this.isLoop)return this.currFrame-=1,this.stop(),void this.frameComplete();if(this.frameComplete(),!this.isPlay)return;this.currFrame=this.beginFrame}for(var r,a=this.layerArr.length,n=0;a>n;n++)try{var l,s=this.layerArr[n],h=s.frames,o=null,m=null,c=null;s.img instanceof e.ZImage&&(o=s.img),s.mc instanceof i&&(m=s.mc),s.li instanceof e.LargeImage&&(c=s.li);try{if(l=h[this.currFrame],this.parentCFOObj[n]==l||null==l){null!=m&&null!=m.parent&&this.mcObj.frameTime==m.mcObj.frameTime&&m.nextFrame();continue}this.parentCFOObj[n]=l}catch(u){null!=o&&this==o.parent&&this.removeChild(o),null!=m&&null!=m.parent&&(m.stop(),m.parent.removeChild(m)),null!=c&&this==c.parent&&this.removeChild(c);continue}if(null==l.libName)null!=o&&this==o.parent&&this.removeChild(o),null!=m&&null!=m.parent&&(m.stop(),m.parent.removeChild(m)),null!=c&&this==c.parent&&this.removeChild(c);else{var d=e.Util.getTextureByName(this.imgArr,l.libName);if(null==d){var g;null==this.libObj.mcObjs[l.libName]?(null==c?(c=new e.LargeImage(this.imgArr,this.libObj,l.libName),c.touchEnabled=!1,s.li=c,c.img_depth=n):c.setObject(this.imgArr,this.libObj,l.libName),g=c,c.matrix=l.matrix,null==c.parent&&this.addChildToDepth(c),null!=m&&this==m.parent&&(this.removeChild(m),m.visible=!1)):(null==m?(m=new i(this.imgArr,this.libObj,l.libName),m.touchEnabled=!1,s.mc=m,m.img_depth=n):l.libName!=m._mcName&&m.setMovieObject(this.imgArr,this.libObj,l.libName),g=m,null==m.parent?(this.isPlay?this.mcObj.frameTime==m.mcObj.frameTime?m.gotoAndStop(0):m.gotoAndPlay(0):m.gotoAndStop(0),m.setTimeScale(this._timeScale),this.addChildToDepth(m)):this.mcObj.frameTime==m.mcObj.frameTime&&m.nextFrame(),this==m.parent&&(m.matrix=l.matrix),null!=c&&this==c.parent&&this.removeChild(c)),g.anchorOffsetX=l.cx,g.anchorOffsetY=l.cy,g.alpha=l.al,null!=o&&this==o.parent&&this.removeChild(o)}else null==o?(o=new e.ZImage(d),o.img_depth=n,o.touchEnabled=!1,s.img=o):o.setTexture(d),null!=this.libObj.imgScale&&null!=this.libObj.imgScale[l.libName]?o.setScale(this.libObj.scale*this.libObj.imgScale[l.libName]):o.setScale(this.libObj.scale),o.displayLibName=l.libName,o.matrix=l.matrix,o.anchorOffsetX=l.cx,o.anchorOffsetY=l.cy,o.alpha=l.al,null==o.parent&&this.addChildToDepth(o),null!=m&&null!=m.parent&&(m.stop(),m.parent.removeChild(m)),null!=c&&this==c.parent&&this.removeChild(c)}var v=null;if(null!=o&&null!=o.parent?v=o:null!=m&&null!=m.parent?v=m:null!=c&&null!=c.parent&&(v=c),null!=v){if(null!=l.maskID){if(null!=r&&null!=r[l.maskID]&&null==v.parent.mask){var f=r[l.maskID],p=new egret.Rectangle(f.x,f.y,f.width,f.height);v.parent.mask=p}}else null!=l.id&&(null==r&&(r={}),r[l.id]=v,v.visible=!1);null!=l.mcName&&(v.name=l.mcName,this.dispatchEventWith(i.EVENT_MC_NAME,!1,v))}}catch(u){}if(null!=this.fmObj){var E=this.fmObj[this.currFrame];null!=E&&(null==E[this._scale]&&(E[this._scale]={},E[this._scale].x=E.x*this._scale,E[this._scale].y=E.y*this._scale,E[this._scale].moveType=E.moveType),this.dispatchEventWith(i.EVENT_MOVE,!1,E[this._scale]))}this.framePlay()}},i.EVENT_FRAME_COMPLETE="zframeComplete",i.EVENT_MOVE="move",i.EVENT_ENTER_FRAME="zenterFrame",i.EVENT_MC_NAME="mcName",i.EVENT_AREA="area",i.EVENT_GOTOANDPLAYLABEL="gotoAndPlayLabel",i}(egret.DisplayObjectContainer);e.ZMovieClip=t,egret.registerClass(t,"zmovie.ZMovieClip")}(zmovie||(zmovie={}));